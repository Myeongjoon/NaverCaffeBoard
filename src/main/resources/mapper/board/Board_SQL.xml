<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
<mapper namespace="com.navercorp.mjboard.board.dao.BoardDAO">

	<resultMap  type="boardDtl" id="boardDtlResultMap" >
		<id property="boardNo" column="board_no"/>
		<result property="title" column="title"/>
		<result property="hitCnt" column="hit_cnt"/>
		<result property="regDate" column="reg_date"/>
		<result property="regId" column="reg_id"/>
	</resultMap>
	
	
	<select id="selectBoardList" resultMap="boardDtlResultMap" parameterType="int">
	       select * 
	       from (select @i:=@i+1 AS iterator , t.*
		   		from (SELECT 
						board_no
						,title
						,hit_cnt
						,reg_date,
						reg_id
					FROM 
						board
					WHERE
						del_check='N'
					ORDER BY 
						board_no DESC) as t,(SELECT @i:=0) AS foo) AS rowNumtbl
			WHERE rowNumtbl.iterator BETWEEN #{number}+1 AND #{number}+10
	</select>
	
	<select id="selectTotalBoard" resultType="int">
       SELECT 
			count(board_no)
		FROM 
			board
		WHERE
			del_check='N'
	</select>
	
	<insert id="insertBoard" parameterType="hashmap">
      INSERT 
      INTO 
     	 board(
            	board_no
	           	,title
	            ,content 
	            ,hit_cnt
	            ,del_check 
	            ,reg_date 
	            ,reg_id
        	)
		VALUES(
	            default 
	            ,#{title}
	            ,#{content}
	            ,0
	            ,default 
	            ,now() 
	            ,#{username}
       		 )
	</insert>
	
	<update id="updateHitCnt" parameterType="hashmap">
	 
        UPDATE board 
        SET
            hit_cnt = IFNULL(hit_cnt, 0) + 1
        WHERE
            board_no = #{board_no}    
	</update>
	 
	<select id="selectBoardDetail" parameterType="hashmap" resultMap="boardDtlResultMap">
        SELECT
            board_no,
            hit_cnt,
            reg_id,
            reg_date,
            title,
            content
        FROM
            board
        WHERE
            board_no = #{board_no}        

	</select>
	
	<update id="updateBoard" parameterType="hashmap">
		UPDATE
			board
		SET
			title = #{title}
			,content = #{content}
		WHERE
			board_no = #{board_no}
	</update>
	
	<update id="deleteBoard" parameterType="hashmap">
		UPDATE 
			board
        SET
            del_check = 'Y'
        WHERE
            board_no = #{board_no}
	</update>
</mapper>